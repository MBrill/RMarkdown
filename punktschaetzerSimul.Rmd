---
title: "Simulation eines Punktschätzers"
author: "Manfred Brill"
date: "Sommersemester 2021"
output: 

  html_document: 
    fig_caption: yes
    highlight: pygments
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_float: yes  
    
  html_notebook:
    highlight: pygments
    number_sections: yes
    theme: cosmo
    toc: yes
    encoding: utf-8   
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(knitr)
library(kableExtra)
suppressPackageStartupMessages(library(dplyr))
library(tidyverse)

library(RColorBrewer)
myPalette <- brewer.pal(5, "YlGn")
# Ausgabe von double-Werte mit  zwei Stellen hinter dem Komma
options(digits=3)
```

# Anwendung
Für die Darstellung der Punktschätzer verwenden wir im Skript 
zu schließender Statistik eine Stichprobe aus 10 elektronischen Bauteilen, die wir darauf überprüfen, ob sie funktionstüchtig sind. Dazu verwenden wir
die Codierung 1 für funktionierend und 0 für defekt.
Damit können wir eine einfache Zählvariable erzeugen und die *Erfolgswahrscheinlichkeit* einer Bernoulli-Verteilung, hier die Ausschuss-Wahrscheinlichkeit, schätzen. 
Im Text werden bereits zwei willkürliche Werte aufgezählt. In diesem Dokument setzen wir einen Wert von p und simulieren mit Hilfe von *rbinom* zehn Stichproben, die jeweils wieder 10 Werte enthalten.
Das arithmetische Mittel jeder Stichprobe verwenden wir als Punktschätzer. Damit wollen wir klar machen, dass ein Punktschätzer
so gut wie immer falsch liegt.

Anschließend verwenden wir die Mittelpunktsregel und bilden den Mittelwert
der 10 Punktschätzer als weiterer Schätzer. Dieser ist nochmals näher
am eigentlich verwendeten Wert.

# Initialisierung der Simulation

```{r grundgesamtheit, echo=FALSE}
p_exakt <- 0.32
sd_exakt <- sqrt(p_exakt*(1-p_exakt))
size <- 1
n <- 10
trials <- 10
pestimates <- rep(0.0, n)
sdestimates <- rep(0.0, n)
```

# Simulation
Wir simulieren eine Binomialverteilung mit Erfolgswahrscheinlichkeit p = `r p_exakt` und den Ausprägungen 0 und 1. Wir erzeugen
`r trials` Stichproben und speichern die arithmetischen Mittel
und die Stichprobenvarianz ab.
Der exakte Wert für die Standardabweichung lautet `r sd_exakt`.

Dabei erhalten wir die folgenden Ergebnisse:

```{r simulation, echo=TRUE}
for(i in 1:n) {
   simulation <- rbinom(n, size, p_exakt)
   pestimates[i] <- mean(simulation)
   sdestimates[i] <- sd(simulation)
}

estimates <- tibble(p=pestimates, sd=sdestimates)

estimates
```

Wir erhalten jedes Mal eine andere Schätzung, die mehr oder weniger
weit von der Erfolgswahrscheinlichkeit oder der Standardabweichung entfernt ist. Jedes Mal wenn wir dieses Notebook durchführen
erhalten wir eine andere Schätzung, da die Zufallszahlen nicht mit einem Seed-Value initialisiert werden.

Wir geben die Schätzungen wie auf der Folie in einer Grafik aus.
```{r points,  message=FALSE, echo=TRUE, results='asis'}
plot_data <- tibble(estimates, index = seq.int(from=1, to=n))

ggplot(data = plot_data) +
  geom_point(mapping = aes(x=p, y = index),
             show.legend=FALSE,
             color="darkgreen") +
  xlim(0.0, 1.0) + 
  scale_y_discrete(labels=NULL, breaks=NULL) +
  geom_vline(xintercept=p_exakt,
             color="red") +
  labs(
    title="Punktschätzungen für die Erfolgswahrscheinlichkeit", 
    subtitle="Verwendete Wahrscheinlichkeit p für die Simulation ist 0.32",
    x="Erfolgswahrscheinlichkeit p"
  ) +
  theme(axis.title.y = element_blank())

ggsave(filename="bausteinem.png", plot=last_plot(), 
       device="png",
       path="images/", 
       width=16, height=9, units="cm")
```

Dies können wir auch für die Schätzungen der Standardabweichung durchführen,
dabei verwenden wir die Stichprobenvarianz.

```{r pointssd,  message=FALSE, echo=TRUE, results='asis'}
ggplot(data = plot_data) +
  geom_point(mapping = aes(x=sd, y = index),
             show.legend=FALSE,
             color="darkgreen") +
  xlim(0.0, 1.0) + 
  scale_y_discrete(labels=NULL, breaks=NULL) +
  geom_vline(xintercept=sd_exakt,
             color="red") +
  labs(
    title="Punktschätzungen für die Standardabweichung", 
    subtitle="Exakter Wert für die Standardabweichung ist 0.466",
    x="Standardabweichung sd"
  ) +
  theme(axis.title.y = element_blank())

ggsave(filename="bausteinesd.png", plot=last_plot(), 
       device="png",
       path="images/", 
       width=16, height=9, units="cm")
```


# Mittelwertsregel

Wir können die Mittelwertsregel anwenden, dann werden die Schätzungen besser und erhalten als Schätzung für p den Wert `r mean(estimates$p)` und für
die Standardabweichung `r mean(estimates$sd)`. Hier die Ergebnisse nochmals
in einer Tabelle:

| Punktschätzer      | Werte    |
| ------------------ | -------------- |
| Stichprobenmittel  | `r mean(estimates$p)` |
| Stichprobenstandardabweichung | `r mean(estimates$sd)` |
| ------------ | -------------- |

# Beispiel Reißfestigkeit

In den Folien wird auch ein Beispiel für die Reißfestigkeit betrachtet. 
Wir verwenden die Normalverteilung und schätzen die Parameter dafür mit 
gegebenen fünf Werten.

```{r festigkeit,  message=FALSE, echo=TRUE, results='asis'}
festigkeit <- c(106.0, 102.0, 94.0,107.0, 99.0)

mu_est <- mean(festigkeit)
var_est <- var(festigkeit)
sd_est <- sd(festigkeit)

var_emp <- ((n-1)/n)*var_est
sd_emp <- sqrt(var_emp)
```

Dafür erhalten wir die Punktschätzungen `r mu_est` für den Erwartungswert.
Für die Varianz und Standardabweichung haben wir verschiedene Schätzer
betrachtet, die aber teilweise nicht erwartungstreu sind.
Hier die dafür berechneten Werte in einer Tabelle:

| Parameter         | Werte     |
| ------------------ | -------------- |
| Stichprobenmittel  | `r mu_est` |
| Empirische Varianz | `r var_emp` |
| Empirische Standardabweichung | `r sd_emp`|
| Stichprobenvarianz | `r var_est` |
| Standardabweichung der Stichprobe | `r sd_est`|
| ------------------ | -------------- |

