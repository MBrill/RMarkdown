---
title: "Grafische Ausgabe der von stetigen Verteilungen - die t-Verteilung"
author: "Manfred Brill"
date: "Sommersemester 2021"
output: 
  html_document: 
    fig_caption: yes
    highlight: pygments
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(RColorBrewer)
myPalette <- brewer.pal(5, "YlGn")
# Ausgabe von double-Werte mit  zwei Stellen hinter dem Komma
```

# Daten
Wir definieren einen x-Bereich, die Dichte geben wir mit Hilfe einer
*stat_function* in ggplot aus.

```{r daten, echo=TRUE}
xmin <- -4

daten <- tribble(
  ~x,
  xmin,
  -xmin
)

daten2 <- tribble(
  ~x,
  -3,
  6
)
```

# Die Dichte und Verteilung der t-Verteilung

```{r tglocke, echo=TRUE}
stdGlocke <- ggplot(data = daten, aes(x)) +
  stat_function(fun = dt, n = 1001, args = list(df=1),
                colour="orange", size=1.5) +  
  labs(
    title="Dichte der t-Verteilung mit n=1",
    y=""
  ) 

stdGlocke

ggsave(filename="tGlocke.png", 
       plot=last_plot(), 
       device="png",
       path="images/", 
       width=16, height=9, units="cm")
```

Mit Hilfe der Funktion *pt* erhalten wir eine grafische Ausgabe
der Verteilungsfunktion:

```{r verteilung, echo=TRUE}
stdV <- ggplot(data = daten, aes(x)) +
  stat_function(fun = pt, n = 1001, args = list(df=1),
                colour="orange", size=1.5) +  
  labs(
    title="Verteilung der t-Verteilung mit n=1",
    y=""
  ) 

stdV

ggsave(filename="tV.png", plot=last_plot(), device="png",
       path="images/", width=16, height=9, units="cm")
```

# t-Verteilungen mit verschiedenen Freiheitsgraden

Wir erstellen eine Abbildung der Dichte einer Normalverteilung.
```{r tDichte, echo=TRUE}
ggplot(data = daten, aes(x)) +
  stat_function(fun = dt, n = 1001, args = list(df=8),
                color="orange", size=1.5) +  
  labs(
    title="Dichte der t-Verteilung mit n=4",
    y=""
  ) 

ggsave(filename="tNormal4.png", 
       plot=last_plot(), 
       device="png",
       path="images/", 
       width=16, height=9, units="cm")
```

Zusätzlich erstellen wir noch eine grafische Ausgabe mit drei
Verteilungsfunktionen mit verschiedenen Werten für die Anzahl
der Freiheitsgrade.

```{r mehreredf, echo=TRUE}
ggplot(data = daten, aes(x)) +
  stat_function(fun = dt, n = 1001, args = list(df=1),
                color="red", size=1.5) +  
  stat_function(fun = dt, n = 1001, args = list(df=4),
                color="green", size=1.5) + 
  stat_function(fun = dt, n = 1001, args = list(df=32),
                color="blue", size=1.5) + 
  labs(
    title="Dichtefunktionen der t-Verteilung",
    subtitle="Rot: n=1, Grün: n=4, Blau: n=32",
    y=""
  ) 

ggsave(filename="tDensities.png", 
       plot=last_plot(), 
       device="png",
       path="images/", 
       width=16, height=9, units="cm")
```


```{r mehrereV, echo=TRUE}
ggplot(data = daten, aes(x)) +
  stat_function(fun = pt, n = 1001, args = list(df = 1),
                color="red", size=1.5) +  
  stat_function(fun = pt, n = 1001, args = list(df = 4),
                color="green", size=1.5) + 
  stat_function(fun = pt, n = 1001, args = list(df = 32),
                color="blue", size=1.5) + 
  labs(
    title="Verteilungsfunktionen der t-Verteilung",
    subtitle="Rot: n=1, Grün: n=4, Blau: n=32",
    y=""
  ) 

ggsave(filename="tDistris.png", plot=last_plot(), device="png",
       path="images/", width=16, height=9, units="cm")
```

# Konfidenzintervalle

Wir erstellen eine grafische Darstellung
eines 95%-Konfidenzintervalls einer t-Verteilung mit 4 Freiheitsgraden. Diese Abbildung verwenden wir beim Thema
Berechnung von Intervallschätzungen.

```{r 95ProzentArea, echo=TRUE}
# Polygonwerte für den gefüllten Bereich
df <- 4
qu <- 0.975
ql <- 1.0-qu

# Wie viele Punkte verwenden wir für die Glockenkurve
l <- 1000
# Unterer und oberer x-Wert mit qnorm berechnen
ub <- qt(qu, df=df)
lb <- qt(ql, df=df)
pmin <- lb
pmax <- ub

# x-Werte für das Polygon besetzen
px <- seq(pmin, pmax, length=l)
# Funktionswerte berechnen mit dnorm
py <- dt(px,df=df)

polygonValues <- tibble(px, py)

PerPlot <- ggplot() +
  stat_function(data = daten, aes(x), 
                fun = dt, n = 1001, args = list(df=df),
                colour=myPalette[3], size=1.5) +  
  geom_vline(xintercept=pmax) +
  geom_vline(xintercept=pmin) +
  labs(
    title= "t-Verteilung mit 4 Freiheitsgraden - 95% Konfidenzintervall",
    y=""
  ) 

PerPlot +
    geom_area(data=polygonValues, mapping=aes(x=px, y=py),
              fill=myPalette[1])

ggsave(filename="konfidenzT.png", 
       plot=last_plot(), 
       device="png",
       path="images/", 
       width=16, height=9, units="cm")
```